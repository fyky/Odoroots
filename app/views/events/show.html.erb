<main>
  <!-- イベント名 -->
  <h1><%= @event.name %></h1>
    <!-- イベント開催、参加ボタン -->
    <% unless Date.current > @event.date %>
      <button class="button02">開催前</button>
        <% if @event.recruitment == true %>
          <button class="button02">参加募集中</button>
        <% else %>
          <button class="button01">募集終了しました</button>
        <% end %>
    <% else %>
      <button class="button01">開催終了</button>
    <% end %>

    <!-- いいね -->
    <div class="<%= "event_" + @event.id.to_s %>", style="display:inline-block;">
      <%= render "favorites/favorite", event: @event %>
    </div>



  <div class="container">
    <!-- イベント写真 -->
    <div class="event_image">
      <%= attachment_image_tag @event, :image, :fill, 600, 400, fallback: "/assets/noimage.png" %>
    </div>


    <div class="event_main">


      <p>
        <h2>開催日時</h2>
          <%= @event.date %>
          <%= @event.start_time.strftime( "%H:%M" ) %>から<%= @event.end_time.strftime( "%H:%M" ) %>
      </p>
      <p>
        <h2>開催地　</h2>
          <%= @event.address %>
      </p>
      <p>
        <h2>参加人数</h2>
          <%= @event.reservations.where(permission: "done").count %>人/<%= @event.number %>人（定員）
      </p>
      <p>
        <h2>参加条件</h2>
          <%= @event.requirement %>
      </p>

      <!-- 予約ボタン表示 -->
      <% unless Date.current > @event.date %>
        <%= link_to new_event_reservation_path(@event) do %>予約へ進む<% end %>
      <% end %>

    </div>
  </div>

  <div class="event_detail">
    <h3>主催者</h3><br>
    <div class="host_image">
      <%= attachment_image_tag @event.user, :image, :fill, 200, 200, style: "border-radius:100px;", fallback: "/assets/noimage.png" %><br>
      <%= link_to user_path(@event.user.id) do %><%= @event.user.name %><% end %>
    </div>
    <div class="balloon2-left">
      <%= @event.introduction %>
    </div>
    <br>

    <h3>開催地（詳細）</h3>
      <p><%= @event.address %><%= @event.address_detail %></p>

    <h3>コメント</h3>
    <p>コメント件数：<%= @event.comments.count %>件</p>
      <% @event.comments.reverse.each do |comment| %>
        <div class="comment">
          <div class="comment_image">
              <%= attachment_image_tag comment.user, :image, :fill, 50, 50, style: "border-radius:20px;", fallback: "/assets/noimage.png", size:'50x50' %><br>

          </div>
          <div class="comment_text">
            <p>
              <%= link_to user_path(comment.user) do %>
              <%= comment.user.name %>
              <% end %>
              <small style="color:#a9a9a9;"><%= comment.created_at.strftime('%Y/%m/%d %H:%M:%S') %></small></p>
            <p><%= comment.comment %></p>
          </div>
      </div>
      <% end %>

      <h5><p>コメントを投稿する</p></h5>
        <%= form_with(model:[@event, @comment], local: true) do |f| %>
          <p>
            <%= f.text_area :comment, class: "comment_form", rows:'5',placeholder: "コメントをここに" %>
            <%= f.submit "送信する", :class => 'comment_send' %>
          </p>
        <% end %>


    <% if @event.user.id = current_user.id %>
      <h2>参加承認</h2>
        <table>
          <tr>
            <th>予約したユーザー</th>
            <th>予約時のコメント</th>
            <th>承認ステータス状態</th>
          </tr>
        <% @reservations.each do |reservation| %>
          <tr>
            <td><%= reservation.user.name %></td>
            <td><%= reservation.comment %></td>
            <td>
              <%= form_with model: reservation, url: event_reservation_path(reservation.event, reservation), local: true do |f| %>
                <%= f.select :permission, Reservation.permissions.keys.map {|k| [I18n.t("enums.reservation.permission.#{k}"), k]} %>
                <%= f.submit "更新", class: "" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </table>
    <% end %>
  </div>
</main>